<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hardcore MineSlots</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @font-face {
            font-family: 'Minecraft';
            src: url('https://cdn.jsdelivr.net/gh/South-Paw/typeface-minecraft/dist/Minecraft.woff2') format('woff2');
        }

        :root {
            --bg-gui: #C6C6C6;
            --slot-bg: #8B8B8B;
            --text-shadow: 2px 2px 0px #3f3f3f;
        }

        body {
            background-color: #1a1a1a;
            /* –¢–µ–∫—Å—Ç—É—Ä–∞ –∫–∞–º–Ω—è –Ω–∞ —Ñ–æ–Ω–µ */
            background-image: repeating-linear-gradient(45deg, #222 25%, transparent 25%, transparent 75%, #222 75%, #222), repeating-linear-gradient(45deg, #222 25%, #1a1a1a 25%, #1a1a1a 75%, #222 75%, #222);
            background-position: 0 0, 10px 10px;
            background-size: 20px 20px;
            font-family: 'Minecraft', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            color: white;
            overflow: hidden;
            user-select: none;
        }

        /* --- UI Header --- */
        .header {
            width: 100%;
            /* –¢–µ–∫—Å—Ç—É—Ä–∞ —Ç—Ä–∞–≤—ã —Å –∑–µ–º–ª–µ–π */
            background: linear-gradient(to bottom, #589c28 0%, #589c28 40%, #5d4037 40%, #5d4037 100%);
            padding: 15px 0;
            text-align: center;
            border-bottom: 4px solid #000;
            box-shadow: 0 5px 10px rgba(0,0,0,0.5);
            z-index: 20;
            position: relative;
        }
        
        /* –î–µ–∫–æ—Ä —Ç—Ä–∞–≤—ã —Å–≤–µ—Ä—Ö—É */
        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 10px;
            background-color: #6bbe31; /* –°–≤–µ—Ç–ª–∞—è —Ç—Ä–∞–≤–∞ */
        }

        .balance-box {
            font-size: 28px;
            text-shadow: var(--text-shadow);
            color: #fff;
        }

        /* --- Game Area --- */
        .game-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 400px;
            padding-bottom: 20px;
        }

        /* --- Slots (Inventory) --- */
        .inventory-container {
            background-color: var(--bg-gui);
            padding: 6px;
            border: 4px solid #373737;
            border-radius: 4px;
            box-shadow: inset 4px 4px #FFF, inset -4px -4px #555;
            margin-bottom: 20px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 4px;
        }

        .slot {
            width: 55px;
            height: 55px;
            background-color: var(--slot-bg);
            border: 2px solid;
            border-color: #373737 #FFF #FFF #373737; /* –í–¥–∞–≤–ª–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            position: relative;
        }

        /* --- Mining & Chests --- */
        .mining-area {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px; /* –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏ */
            width: 100%;
            padding: 0 10px;
            box-sizing: border-box;
        }

        .mining-col {
            position: relative;
            width: 100%;
            height: 70px; /* –í—ã—Å–æ—Ç–∞ –∑–æ–Ω—ã –±–ª–æ–∫–∞/—Å—É–Ω–¥—É–∫–∞ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }

        /* –°—É–Ω–¥—É–∫ (–≤—Å–µ–≥–¥–∞ —Å–Ω–∏–∑—É) */
        .chest-base {
            width: 50px;
            height: 50px;
            background-color: #6d4c41;
            border: 2px solid #3e2723;
            position: absolute;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 1;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
        }
        
        .chest-lid {
            width: 50px;
            height: 15px;
            background-color: #8d6e63;
            border: 2px solid #3e2723;
            position: absolute;
            top: -10px;
            left: -2px;
            transition: transform 0.2s;
        }

        .chest-base.open .chest-lid {
            transform: translateY(-5px) rotateX(45deg);
        }

        /* –ë–ª–æ–∫ (–ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç —Å—É–Ω–¥—É–∫) */
        .block-obstacle {
            width: 50px;
            height: 50px;
            border: 2px solid #000;
            position: absolute;
            bottom: 0;
            z-index: 10; /* –°–≤–µ—Ä—Ö—É —Å—É–Ω–¥—É–∫–∞ */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 0 #000;
            image-rendering: pixelated;
        }

        /* –¢–µ–∫—Å—Ç—É—Ä—ã –±–ª–æ–∫–æ–≤ (CSS only) */
        .b-dirt { background: #5d4037; box-shadow: inset 4px 4px #795548; }
        .b-stone { background: #757575; box-shadow: inset 4px 4px #9e9e9e; }
        .b-coal { background: #757575; background-image: radial-gradient(#212121 20%, transparent 20%); background-size: 10px 10px; }
        .b-iron { background: #9e9e9e; background-image: radial-gradient(#d7ccc8 25%, transparent 25%); background-size: 12px 12px;}
        .b-gold { background: #757575; background-image: radial-gradient(#ffeb3b 25%, transparent 25%); background-size: 12px 12px;}
        .b-diamond { background: #757575; background-image: radial-gradient(#00e5ff 25%, transparent 25%); background-size: 12px 12px;}
        .b-obsidian { background: #1a1a1a; border-color: #4a148c; }

        /* Controls */
        .controls {
            margin-top: auto;
            margin-bottom: 20px;
            text-align: center;
            width: 100%;
        }

        .btn-spin {
            background: #999;
            border: 4px solid #000;
            box-shadow: inset 4px 4px #ccc, inset -4px -4px #555, 0 6px 0 #000;
            color: #fff;
            font-family: 'Minecraft';
            font-size: 24px;
            padding: 15px 50px;
            cursor: pointer;
            text-shadow: 2px 2px #000;
            width: 80%;
            transition: transform 0.1s;
        }

        .btn-spin:active {
            transform: translateY(6px);
            box-shadow: inset 4px 4px #555, inset -4px -4px #ccc, 0 0 0 #000;
        }

        .btn-spin:disabled {
            background: #555;
            color: #888;
            box-shadow: none;
            transform: translateY(6px);
        }

        /* Animations */
        @keyframes damageShake {
            0% { transform: translate(0, 0); }
            25% { transform: translate(-3px, 2px); filter: brightness(1.5) sepia(1) hue-rotate(-50deg) saturate(5); } /* –ö—Ä–∞—Å–Ω–∞—è –≤—Å–ø—ã—à–∫–∞ */
            50% { transform: translate(3px, -2px); }
            75% { transform: translate(-3px, 0); }
            100% { transform: translate(0, 0); filter: none; }
        }

        @keyframes fallIn {
            from { transform: translateY(-200px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes popupFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-60px) scale(1.5); opacity: 0; }
        }

        .damaged { animation: damageShake 0.3s; }
        .falling { animation: fallIn 0.4s ease-out; }
        
        .float-text {
            position: absolute;
            z-index: 100;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
            animation: popupFloat 1s forwards;
            pointer-events: none;
            width: 100%;
            text-align: center;
            top: -20px;
        }

    </style>
</head>
<body>

    <div class="header">
        <div class="balance-box">üíé <span id="balance">5000</span></div>
    </div>

    <div class="game-wrapper">
        <!-- –°–ª–æ—Ç—ã (–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å) -->
        <div class="inventory-container">
            <div class="inventory-grid" id="slots-grid">
                <!-- JS will fill this -->
            </div>
        </div>

        <!-- –ó–æ–Ω–∞ –±–ª–æ–∫–æ–≤ –∏ —Å—É–Ω–¥—É–∫–æ–≤ -->
        <div class="mining-area" id="mining-area">
            <!-- JS will fill this -->
        </div>
    </div>

    <div class="controls">
        <div id="info-text" style="color: #aaa; margin-bottom: 10px; font-size: 14px;">–ö–∏—Ä–∫–∏ –ª–æ–º–∞—é—Ç –±–ª–æ–∫–∏. –í —Å—É–Ω–¥—É–∫–∞—Ö –Ω–∞–≥—Ä–∞–¥–∞.</div>
        <button class="btn-spin" id="spin-btn" onclick="spin()">–ö–†–£–¢–ò–¢–¨ (100)</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        /* --- HARDCORE CONFIG --- */
        const CONFIG = {
            spinCost: 100,
            rows: 3,
            cols: 5,
            
            // 1. –®–∞–Ω—Å –≤—ã–ø–∞–¥–µ–Ω–∏—è –≤ —Å–ª–æ—Ç–µ (—Å—É–º–º–∞ –≤–µ—Å–æ–≤)
            // –ú–Ω–æ–≥–æ –ø—É—Å—Ç–æ—Ç—ã, –º–∞–ª–æ —Ö–æ—Ä–æ—à–∏—Ö –∫–∏—Ä–æ–∫.
            dropWeights: {
                empty: 100,      // –ü—É—Å—Ç–æ—Ç–∞ (–°–∞–º–æ–µ —á–∞—Å—Ç–æ–µ)
                wood_pick: 50,   // –î–µ—Ä–µ–≤–æ (–£—Ä–æ–Ω 1) - –ß–∞—Å—Ç–æ–µ
                stone_pick: 30,  // –ö–∞–º–µ–Ω—å (–£—Ä–æ–Ω 2)
                iron_pick: 10,   // –ñ–µ–ª–µ–∑–æ (–£—Ä–æ–Ω 4)
                diamond_pick: 3, // –ê–ª–º–∞–∑ (–£—Ä–æ–Ω 10) - –†–µ–¥–∫–æ–µ
                tnt: 1           // –¢–ù–¢ (–£–±–∏–≤–∞–µ—Ç –±–ª–æ–∫ —Å—Ä–∞–∑—É) - –û—á–µ–Ω—å —Ä–µ–¥–∫–æ–µ
            },

            // 2. –ë–ª–æ–∫–∏ –∏ –∏—Ö –ø—Ä–æ—á–Ω–æ—Å—Ç—å (HP)
            // HP —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–æ —Ç–∞–∫, —á—Ç–æ —Å –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–π –∫–∏—Ä–∫–æ–π (dmg 1) –ª–æ–º–∞—Ç—å –¥–æ–ª–≥–æ.
            blockTypes: [
                { id: 'dirt', hp: 5, class: 'b-dirt', name: '–ó–µ–º–ª—è' },      // 5 —É–¥–∞—Ä–æ–≤ –¥–µ—Ä–µ–≤–æ–º
                { id: 'stone', hp: 15, class: 'b-stone', name: '–ö–∞–º–µ–Ω—å' },  // 15 —É–¥–∞—Ä–æ–≤ –¥–µ—Ä–µ–≤–æ–º
                { id: 'coal', hp: 25, class: 'b-coal', name: '–£–≥–æ–ª—å' },
                { id: 'iron', hp: 40, class: 'b-iron', name: '–ñ–µ–ª–µ–∑–æ' },
                { id: 'gold', hp: 60, class: 'b-gold', name: '–ó–æ–ª–æ—Ç–æ' },
                { id: 'diamond', hp: 100, class: 'b-diamond', name: '–ê–ª–º–∞–∑' },
                { id: 'obsidian', hp: 200, class: 'b-obsidian', name: '–û–±—Å–∏–¥–∏–∞–Ω' }
            ],

            // 3. –≠–∫–æ–Ω–æ–º–∏–∫–∞ —Å—É–Ω–¥—É–∫–æ–≤ (–ú–Ω–æ–∂–∏—Ç–µ–ª–∏ –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å–ø–∏–Ω–∞)
            // –ß—Ç–æ–±—ã "–Ω–µ –æ–∫—É–ø–∞–ª–æ—Å—å": –°—Ä–µ–¥–Ω–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ, 
            // —á–µ–º —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª-–≤–æ —Å–ø–∏–Ω–æ–≤ –Ω–∞ –ª–æ–º–∞–Ω–∏–µ –±–ª–æ–∫–∞.
            multipliers: [0.1, 0.2, 0.5, 0.5, 1.0, 1.5, 2.0, 5.0, 10.0],
            // –í–µ—Å–∞ –¥–ª—è –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π (—á–∞—â–µ –≤—Å–µ–≥–æ –≤—ã–ø–∞–¥–∞–µ—Ç 0.5x - 1.0x)
            multiplierWeights: [30, 30, 20, 10, 5, 3, 1, 0.5, 0.1] 
        };

        const ITEMS = {
            wood_pick: { img: 'ü™µ', dmg: 1, color: '#8d6e63' },
            stone_pick: { img: 'ü™®', dmg: 2, color: '#9e9e9e' },
            iron_pick: { img: '‚ö™', dmg: 4, color: '#fff' },
            diamond_pick: { img: 'üíé', dmg: 10, color: '#00e5ff' },
            tnt: { img: 'üß®', dmg: 999, color: '#ff5252' },
            empty: { img: '', dmg: 0, color: 'transparent' }
        };

        let balance = parseInt(localStorage.getItem('hc_balance')) || 5000;
        let blockStates = []; // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–æ–≤ –≤ 5 –∫–æ–ª–æ–Ω–∫–∞—Ö

        function init() {
            renderUI();
            createSlots();
            createMiningArea();
        }

        function renderUI() {
            document.getElementById('balance').innerText = Math.floor(balance);
            localStorage.setItem('hc_balance', Math.floor(balance));
        }

        function createSlots() {
            const grid = document.getElementById('slots-grid');
            grid.innerHTML = '';
            for(let i=0; i<15; i++) {
                let slot = document.createElement('div');
                slot.className = 'slot';
                slot.id = `slot-${i}`;
                grid.appendChild(slot);
            }
        }

        function createMiningArea() {
            const area = document.getElementById('mining-area');
            area.innerHTML = '';
            
            // –ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–ª–æ–∫–∏
            if (blockStates.length === 0) {
                // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–µ—Å–ª–∏ –∏–≥—Ä–∞–ª–∏ —Ä–∞–Ω–µ–µ)
                let saved = localStorage.getItem('hc_blocks');
                if (saved) {
                    blockStates = JSON.parse(saved);
                } else {
                    for(let i=0; i<CONFIG.cols; i++) blockStates.push(generateNewBlock());
                }
            }

            for(let i=0; i<CONFIG.cols; i++) {
                let col = document.createElement('div');
                col.className = 'mining-col';
                col.id = `col-${i}`;

                // –°—É–Ω–¥—É–∫ (Background layer)
                let chest = document.createElement('div');
                chest.className = 'chest-base';
                chest.innerHTML = `<div class="chest-lid"></div><span id="chest-content-${i}"></span>`;
                col.appendChild(chest);

                // –ë–ª–æ–∫ (Foreground layer)
                renderBlockInCol(col, i);

                area.appendChild(col);
            }
        }

        function renderBlockInCol(colElement, index) {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –±–ª–æ–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
            let old = colElement.querySelector('.block-obstacle');
            if (old) old.remove();

            let data = blockStates[index];
            let block = document.createElement('div');
            block.className = `block-obstacle ${data.class}`;
            block.id = `block-${index}`;
            block.innerText = data.currentHp;
            colElement.appendChild(block);
        }

        function generateNewBlock() {
            // –†–∞–Ω–¥–æ–º –±–ª–æ–∫–∞. –ß–µ–º –∫—Ä—É—á–µ –±–ª–æ–∫, —Ç–µ–º —Ä–µ–∂–µ.
            const rand = Math.random();
            let type;
            if (rand < 0.4) type = CONFIG.blockTypes[0];      // Dirt
            else if (rand < 0.7) type = CONFIG.blockTypes[1]; // Stone
            else if (rand < 0.85) type = CONFIG.blockTypes[2];// Coal
            else if (rand < 0.92) type = CONFIG.blockTypes[3];// Iron
            else if (rand < 0.97) type = CONFIG.blockTypes[4];// Gold
            else if (rand < 0.99) type = CONFIG.blockTypes[5];// Diamond
            else type = CONFIG.blockTypes[6];                 // Obsidian

            return { ...type, currentHp: type.hp }; // –ö–æ–ø–∏—è –æ–±—ä–µ–∫—Ç–∞ —Å —Ç–µ–∫—É—â–∏–º HP
        }

        let isSpinning = false;

        async function spin() {
            if (isSpinning) return;
            if (balance < CONFIG.spinCost) {
                tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
                return;
            }

            balance -= CONFIG.spinCost;
            renderUI();
            isSpinning = true;
            document.getElementById('spin-btn').disabled = true;

            tg.HapticFeedback.impactOccurred('medium');

            // 1. –í—Ä–∞—â–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤
            const slotResults = [];
            const slots = document.querySelectorAll('.slot');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —à—É–º–∞
            let spinInterval = setInterval(() => {
                slots.forEach(s => s.innerText = Math.random() > 0.5 ? '‚õèÔ∏è' : '');
            }, 100);

            await new Promise(r => setTimeout(r, 800));
            clearInterval(spinInterval);

            // 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            for (let i = 0; i < 15; i++) {
                let itemKey = getWeightedRandom(CONFIG.dropWeights);
                slotResults.push(itemKey);
                let el = document.getElementById(`slot-${i}`);
                el.innerText = ITEMS[itemKey].img;
                if (ITEMS[itemKey].color !== 'transparent') {
                    el.style.textShadow = `0 0 10px ${ITEMS[itemKey].color}`;
                } else {
                    el.style.textShadow = 'none';
                }
            }

            // 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ (–õ–æ–≥–∏–∫–∞ –ø–∞–¥–µ–Ω–∏—è)
            await applyDamage(slotResults);

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–ª–æ–∫–æ–≤
            localStorage.setItem('hc_blocks', JSON.stringify(blockStates));

            isSpinning = false;
            document.getElementById('spin-btn').disabled = false;
        }

        async function applyDamage(flatResults) {
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º 15 —Å–ª–æ—Ç–æ–≤ –≤ 5 –∫–æ–ª–æ–Ω–æ–∫ –ø–æ 3 —Ä—è–¥–∞
            for (let col = 0; col < CONFIG.cols; col++) {
                let totalDmgInCol = 0;
                let hasTNT = false;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º 3 —Å–ª–æ—Ç–∞ –Ω–∞–¥ –∫–æ–ª–æ–Ω–∫–æ–π
                for (let row = 0; row < CONFIG.rows; row++) {
                    let itemKey = flatResults[row * CONFIG.cols + col];
                    if (itemKey === 'tnt') hasTNT = true;
                    totalDmgInCol += ITEMS[itemKey].dmg;
                }

                if (totalDmgInCol > 0) {
                    let blockEl = document.getElementById(`block-${col}`);
                    
                    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç —É–¥–∞—Ä–∞
                    if(blockEl) {
                        blockEl.classList.add('damaged');
                        setTimeout(() => blockEl.classList.remove('damaged'), 300);
                        tg.HapticFeedback.impactOccurred('light');
                    }

                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    if (hasTNT) blockStates[col].currentHp = 0;
                    else blockStates[col].currentHp -= totalDmgInCol;

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –±–ª–æ–∫–µ
                    if (blockEl) blockEl.innerText = Math.max(0, blockStates[col].currentHp);

                    // –ï—Å–ª–∏ –±–ª–æ–∫ —Å–ª–æ–º–∞–Ω
                    if (blockStates[col].currentHp <= 0) {
                        await breakBlock(col);
                    }
                }
            }
        }

        async function breakBlock(colIndex) {
            let colEl = document.getElementById(`col-${colIndex}`);
            let blockEl = document.getElementById(`block-${colIndex}`);
            
            // –ó–≤—É–∫ (–≤–∏–±—Ä–∞—Ü–∏—è) —É—Å–ø–µ—Ö–∞
            tg.HapticFeedback.notificationOccurred('success');

            // 1. –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –±–ª–æ–∫–∞
            if (blockEl) blockEl.style.display = 'none';

            // 2. –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—É–Ω–¥—É–∫–∞
            let chestBase = colEl.querySelector('.chest-base');
            chestBase.classList.add('open');

            // 3. –†–∞—Å—á–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã (–ñ–∞–¥–Ω—ã–π —Ä–∞–Ω–¥–æ–º)
            // –í—ã–±–∏—Ä–∞–µ–º –∏–Ω–¥–µ–∫—Å –º–Ω–æ–∂–∏—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–æ–≤
            let multIndex = getWeightedIndex(CONFIG.multiplierWeights);
            let multiplier = CONFIG.multipliers[multIndex];
            
            let win = Math.floor(CONFIG.spinCost * multiplier);
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞–≥—Ä–∞–¥—ã
            let floatText = document.createElement('div');
            floatText.className = 'float-text';
            floatText.innerHTML = `<span style="color:#ff5555">-${CONFIG.spinCost} —Å–ø</span> <span style="color:#55ff55">+${win}</span>`;
            if (multiplier < 1.0) floatText.style.color = '#ff5555'; // –ö—Ä–∞—Å–Ω—ã–π –µ—Å–ª–∏ –Ω–µ –æ–∫—É–ø–∏–ª–æ—Å—å
            else floatText.style.color = '#ffff55'; // –ó–æ–ª–æ—Ç–æ–π –µ—Å–ª–∏ –æ–∫—É–ø–∏–ª–æ—Å—å
            
            colEl.appendChild(floatText);
            setTimeout(() => floatText.remove(), 1500);

            balance += win;
            renderUI();

            // 4. –ü–∞—É–∑–∞ –∏ –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±–ª–æ–∫–∞
            await new Promise(r => setTimeout(r, 1000));

            chestBase.classList.remove('open'); // –ó–∞–∫—Ä—ã—Ç—å —Å—É–Ω–¥—É–∫
            
            // –ù–æ–≤—ã–π –±–ª–æ–∫
            blockStates[colIndex] = generateNewBlock();
            renderBlockInCol(colEl, colIndex);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–µ–Ω–∏—è
            let newBlock = document.getElementById(`block-${colIndex}`);
            newBlock.classList.add('falling');
        }

        // –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –≤–∑–≤–µ—à–µ–Ω–Ω–æ–≥–æ —Ä–∞–Ω–¥–æ–º–∞ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ö–õ–Æ–ß –æ–±—ä–µ–∫—Ç–∞)
        function getWeightedRandom(weightsObj) {
            let total = 0;
            for (let k in weightsObj) total += weightsObj[k];
            let rand = Math.random() * total;
            for (let k in weightsObj) {
                if (rand < weightsObj[k]) return k;
                rand -= weightsObj[k];
            }
            return 'empty';
        }

        // –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –≤–∑–≤–µ—à–µ–Ω–Ω–æ–≥–æ —Ä–∞–Ω–¥–æ–º–∞ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ò–ù–î–ï–ö–° –º–∞—Å—Å–∏–≤–∞)
        function getWeightedIndex(weightsArr) {
            let total = weightsArr.reduce((a, b) => a + b, 0);
            let rand = Math.random() * total;
            for (let i = 0; i < weightsArr.length; i++) {
                if (rand < weightsArr[i]) return i;
                rand -= weightsArr[i];
            }
            return 0;
        }

        init();
    </script>
</body>
</html>
