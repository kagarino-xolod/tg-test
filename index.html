<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MineCraft Slots</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @font-face {
            font-family: 'Minecraft';
            src: url('https://cdn.jsdelivr.net/gh/South-Paw/typeface-minecraft/dist/Minecraft.woff2') format('woff2');
        }

        :root {
            --bg-gui: #C6C6C6;
            --slot-bg: #8B8B8B;
            --slot-border-light: #FFFFFF;
            --slot-border-dark: #373737;
            --text-shadow: 2px 2px 0px #3f3f3f;
        }

        body {
            background-color: #121212;
            background-image: url('https://www.transparenttextures.com/patterns/dirt.png'); /* –¢–µ–∫—Å—Ç—É—Ä–∞ –∑–µ–º–ª–∏ */
            font-family: 'Minecraft', 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            margin: 0;
            color: white;
            overflow: hidden;
            user-select: none;
        }

        /* --- UI Header --- */
        .header {
            width: 100%;
            background: linear-gradient(to bottom, #74b72e 0%, #74b72e 50%, #563816 50%, #563816 100%);
            padding: 10px 0;
            text-align: center;
            border-bottom: 4px solid #000;
            box-shadow: 0 4px 0 rgba(0,0,0,0.5);
            z-index: 10;
        }

        .balance-box {
            font-size: 24px;
            text-shadow: var(--text-shadow);
        }

        /* --- Main Game Container --- */
        .game-container {
            margin-top: 20px;
            background-color: var(--bg-gui);
            padding: 10px;
            border: 4px solid #000;
            border-radius: 4px;
            box-shadow: inset -4px -4px #555, inset 4px 4px #FFF;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        /* --- The 3x5 Grid (Inventory) --- */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 4px;
            background: #C6C6C6;
        }

        .slot {
            width: 50px;
            height: 50px;
            background-color: var(--slot-bg);
            border-bottom: 2px solid var(--slot-border-light);
            border-right: 2px solid var(--slot-border-light);
            border-top: 2px solid var(--slot-border-dark);
            border-left: 2px solid var(--slot-border-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            position: relative;
        }

        /* --- Mining Area (Blocks & Chests) --- */
        .mining-area {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
            margin-top: 10px;
            position: relative;
        }

        .mining-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 50px;
        }

        .block {
            width: 48px;
            height: 48px;
            background-size: cover;
            border: 2px solid #000;
            position: relative;
            image-rendering: pixelated;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            text-shadow: 1px 1px 0 #000;
            transition: transform 0.1s;
        }

        /* CSS –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç—É—Ä –±–ª–æ–∫–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è) */
        .block.dirt { background-color: #5d4037; }
        .block.stone { background-color: #757575; }
        .block.iron { background-color: #9e9e9e; background-image: radial-gradient(#d7ccc8 20%, transparent 20%); }
        .block.gold { background-color: #757575; background-image: radial-gradient(#ffeb3b 20%, transparent 20%); }
        .block.diamond { background-color: #757575; background-image: radial-gradient(#00e5ff 20%, transparent 20%); }
        .block.obsidian { background-color: #212121; border-color: #4a148c; }

        .chest {
            width: 40px;
            height: 30px;
            margin-top: 5px;
            font-size: 24px;
            text-align: center;
            line-height: 30px;
            transition: transform 0.2s;
        }

        .multiplier-popup {
            position: absolute;
            color: #ffff00;
            font-weight: bold;
            font-size: 18px;
            text-shadow: 2px 2px 0 #000;
            animation: floatUp 1s forwards;
            pointer-events: none;
        }

        /* --- Controls --- */
        .controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        button {
            background-color: #7c7c7c;
            border: 4px solid #000;
            box-shadow: inset 4px 4px #b8b8b8, inset -4px -4px #373737;
            color: #fff;
            font-family: 'Minecraft', sans-serif;
            font-size: 20px;
            padding: 10px 40px;
            cursor: pointer;
            text-shadow: 2px 2px 0 #000;
        }

        button:active {
            box-shadow: inset 4px 4px #373737, inset -4px -4px #b8b8b8;
            transform: translateY(2px);
        }

        button:disabled {
            background-color: #555;
            color: #aaa;
            cursor: not-allowed;
        }

        /* Animations */
        @keyframes spin {
            0% { transform: translateY(-5px); }
            50% { transform: translateY(5px); }
            100% { transform: translateY(-5px); }
        }

        @keyframes dropItem {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(150px); opacity: 0; }
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }

        .spinning {
            animation: spin 0.2s infinite linear;
        }
        
        .dropping {
            animation: dropItem 0.5s forwards ease-in;
            z-index: 100;
        }

        .shaking {
            animation: shake 0.2s;
        }

        .item-img { filter: drop-shadow(2px 2px 0px #000); }

    </style>
</head>
<body>

    <div class="header">
        <div class="balance-box">üíé –ë–∞–ª–∞–Ω—Å: <span id="balance">2000</span></div>
    </div>

    <div class="game-container">
        <!-- 3x5 Grid -->
        <div class="inventory-grid" id="grid">
            <!-- Slots generated by JS -->
        </div>

        <!-- Mining Area -->
        <div class="mining-area" id="mining-area">
            <!-- Blocks and Chests generated by JS -->
        </div>
    </div>

    <div class="controls">
        <div id="status" style="height: 20px; color: #ffff55; text-shadow: 1px 1px 0 #000;">–ù–∞–∂–º–∏ –ö—Ä—É—Ç–∏—Ç—å!</div>
        <button id="spin-btn" onclick="startGame()">–ö–†–£–¢–ò–¢–¨ (100üíé)</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ù–ê–°–¢–†–û–ô–ö–ò (CONFIG) ---
        const CONFIG = {
            spinCost: 100,
            rows: 3,
            cols: 5,
            // –®–∞–Ω—Å—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è –≤ —Å–ª–æ—Ç–∞—Ö (—Å—É–º–º–∞ –≤–µ—Å–æ–≤ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ 100)
            dropWeights: {
                empty: 60,      // –ü—É—Å—Ç–æ–π —Å–ª–æ—Ç
                wood_pick: 20,  // –î–µ—Ä–µ–≤—è–Ω–Ω–∞—è –∫–∏—Ä–∫–∞ (–£—Ä–æ–Ω 1)
                stone_pick: 10, // –ö–∞–º–µ–Ω–Ω–∞—è –∫–∏—Ä–∫–∞ (–£—Ä–æ–Ω 2)
                iron_pick: 5,   // –ñ–µ–ª–µ–∑–Ω–∞—è –∫–∏—Ä–∫–∞ (–£—Ä–æ–Ω 3)
                diamond_pick: 3,// –ê–ª–º–∞–∑–Ω–∞—è –∫–∏—Ä–∫–∞ (–£—Ä–æ–Ω 5)
                ender_pearl: 2  // –≠–Ω–¥–µ—Ä–ø–µ—Ä–ª (–ë–æ–Ω—É—Å)
            },
            // –¢–∏–ø—ã –±–ª–æ–∫–æ–≤ –∏ –∏—Ö –ø—Ä–æ—á–Ω–æ—Å—Ç—å (HP)
            blockTypes: [
                { type: 'dirt', hp: 1, color: '#5d4037' },
                { type: 'stone', hp: 3, color: '#757575' },
                { type: 'iron', hp: 5, color: '#9e9e9e' },
                { type: 'gold', hp: 8, color: '#fbc02d' },
                { type: 'diamond', hp: 12, color: '#00bcd4' },
                { type: 'obsidian', hp: 20, color: '#212121' }
            ],
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π —Å—É–Ω–¥—É–∫–∞
            multiplierMin: 1.2,
            multiplierMax: 5.0
        };

        const ITEMS = {
            wood_pick: { emoji: '‚õèÔ∏è', color: '#8d6e63', dmg: 1 },
            stone_pick: { emoji: '‚õèÔ∏è', color: '#9e9e9e', dmg: 2 },
            iron_pick: { emoji: '‚õèÔ∏è', color: '#eceff1', dmg: 3 },
            diamond_pick: { emoji: '‚õèÔ∏è', color: '#00e5ff', dmg: 5 },
            ender_pearl: { emoji: 'üîÆ', color: '#009688', bonus: 250 }, // –ü—Ä—è–º–æ–π –±–æ–Ω—É—Å
            empty: { emoji: '', color: 'transparent', dmg: 0 }
        };

        let balance = parseInt(localStorage.getItem('mc_balance')) || 2000;
        let isSpinning = false;
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–æ–≤ (5 –∫–æ–ª–æ–Ω–æ–∫)
        let blockState = []; 

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            updateBalanceUI();
            createGrid();
            createMiningArea();
        }

        // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function createGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            for (let i = 0; i < CONFIG.rows * CONFIG.cols; i++) {
                let div = document.createElement('div');
                div.className = 'slot';
                div.id = `slot-${i}`;
                grid.appendChild(div);
            }
        }

        // –°–æ–∑–¥–∞–µ–º –∑–æ–Ω—É –º–∞–π–Ω–∏–Ω–≥–∞ (–±–ª–æ–∫–∏ + —Å—É–Ω–¥—É–∫–∏)
        function createMiningArea() {
            const area = document.getElementById('mining-area');
            area.innerHTML = '';
            blockState = [];

            for (let i = 0; i < CONFIG.cols; i++) {
                // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ–ª–æ–Ω–∫–∏
                let col = document.createElement('div');
                col.className = 'mining-column';
                col.id = `mining-col-${i}`;

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π –±–ª–æ–∫
                let newBlock = generateRandomBlock();
                blockState.push(newBlock);

                // HTML –ë–ª–æ–∫–∞
                let blockDiv = document.createElement('div');
                blockDiv.className = `block ${newBlock.type}`;
                blockDiv.id = `block-${i}`;
                blockDiv.innerText = newBlock.hp; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º HP

                // HTML –°—É–Ω–¥—É–∫–∞
                let chestDiv = document.createElement('div');
                chestDiv.className = 'chest';
                chestDiv.innerText = 'üì¶';
                chestDiv.id = `chest-${i}`;

                col.appendChild(blockDiv);
                col.appendChild(chestDiv);
                area.appendChild(col);
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –±–ª–æ–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–æ - –ø—Ä–æ—Å—Ç–æ —Ä–∞–Ω–¥–æ–º)
        function generateRandomBlock() {
            const rand = Math.random();
            if (rand < 0.4) return { ...CONFIG.blockTypes[0] }; // Dirt 40%
            if (rand < 0.7) return { ...CONFIG.blockTypes[1] }; // Stone 30%
            if (rand < 0.85) return { ...CONFIG.blockTypes[2] }; // Iron 15%
            if (rand < 0.95) return { ...CONFIG.blockTypes[3] }; // Gold 10%
            return { ...CONFIG.blockTypes[4] }; // Diamond 5%
        }

        function updateBalanceUI() {
            document.getElementById('balance').innerText = Math.floor(balance);
            localStorage.setItem('mc_balance', Math.floor(balance));
        }

        // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---

        async function startGame() {
            if (isSpinning) return;
            if (balance < CONFIG.spinCost) {
                tg.showAlert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∞–ª–º–∞–∑–æ–≤! üíé");
                return;
            }

            balance -= CONFIG.spinCost;
            updateBalanceUI();
            isSpinning = true;
            document.getElementById('spin-btn').disabled = true;
            document.getElementById('status').innerText = "–ú–∞–π–Ω–∏–º...";
            
            tg.HapticFeedback.impactOccurred('medium');

            // 1. –ê–Ω–∏–º–∞—Ü–∏—è –∫—Ä—É—á–µ–Ω–∏—è
            const slots = document.querySelectorAll('.slot');
            slots.forEach(s => {
                s.innerText = getRandomItemKey().emoji || '‚ùì';
                s.classList.add('spinning');
            });

            // –ñ–¥–µ–º 1 —Å–µ–∫—É–Ω–¥—É –∫—Ä—É—á–µ–Ω–∏—è
            await new Promise(r => setTimeout(r, 1000));

            // 2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            let results = []; // –î–≤—É–º–µ—Ä–Ω—ã–π –º–∞—Å—Å–∏–≤ [col][row]
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º
            for(let c=0; c<CONFIG.cols; c++) results[c] = [];

            slots.forEach((s, index) => {
                s.classList.remove('spinning');
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç
                let itemKey = getWeightedRandomItem();
                let itemData = ITEMS[itemKey];
                
                // –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è (—Ü–≤–µ—Ç –∫–∏—Ä–æ–∫)
                if (itemData.emoji) {
                    s.innerHTML = `<span style="color:${itemData.color}" class="item-img">${itemData.emoji}</span>`;
                } else {
                    s.innerHTML = '';
                }

                // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º
                let col = index % CONFIG.cols;
                results[col].push(itemKey);
            });

            // 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–ø–∞–≤—à–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
            await processDrops(results);

            isSpinning = false;
            document.getElementById('spin-btn').disabled = false;
            document.getElementById('status').innerText = "–ì–æ—Ç–æ–≤–æ!";
        }

        // –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ —Å —É—á–µ—Ç–æ–º –≤–µ—Å–æ–≤
        function getWeightedRandomItem() {
            let totalWeight = 0;
            for (let k in CONFIG.dropWeights) totalWeight += CONFIG.dropWeights[k];
            
            let random = Math.random() * totalWeight;
            for (let k in CONFIG.dropWeights) {
                if (random < CONFIG.dropWeights[k]) return k;
                random -= CONFIG.dropWeights[k];
            }
            return 'empty';
        }

        // –î–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —à—É–º–∞ –ø—Ä–∏ –∫—Ä—É—á–µ–Ω–∏–∏
        function getRandomItemKey() {
             const keys = Object.keys(ITEMS);
             return ITEMS[keys[Math.floor(Math.random() * keys.length)]];
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–¥–µ–Ω–∏—è –∫–∏—Ä–æ–∫
        async function processDrops(results) {
            let totalWin = 0;

            // –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–µ
            for (let col = 0; col < CONFIG.cols; col++) {
                let columnItems = results[col];
                let blockDiv = document.getElementById(`block-${col}`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —Å–ª–æ—Ç –≤ –∫–æ–ª–æ–Ω–∫–µ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑
                for (let row = 0; row < CONFIG.rows; row++) {
                    let itemKey = columnItems[row];
                    
                    if (itemKey === 'empty') continue;

                    // –ï—Å–ª–∏ –≠–Ω–¥–µ—Ä–ø–µ—Ä–ª - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –±–æ–Ω—É—Å
                    if (itemKey === 'ender_pearl') {
                        showFloatText(col, `+${ITEMS.ender_pearl.bonus}`, '#00ff00');
                        balance += ITEMS.ender_pearl.bonus;
                        updateBalanceUI();
                        tg.HapticFeedback.notificationOccurred('success');
                        continue;
                    }

                    // –ï—Å–ª–∏ –∫–∏—Ä–∫–∞ - –∞–Ω–∏–º–∞—Ü–∏—è –∞—Ç–∞–∫–∏ –±–ª–æ–∫–∞
                    let dmg = ITEMS[itemKey].dmg;
                    
                    // –í–∏–∑—É–∞–ª—å–Ω–æ "—Ä–æ–Ω—è–µ–º" –∫–∏—Ä–∫—É –∏–∑ —Å–ª–æ—Ç–∞
                    let slotIndex = row * CONFIG.cols + col;
                    let slotDiv = document.getElementById(`slot-${slotIndex}`);
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç —É–¥–∞—Ä–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π: –ø—Ä–æ—Å—Ç–æ —Ç—Ä—è—Å–∫–∞ –±–ª–æ–∫–∞ —á–µ—Ä–µ–∑ –∑–∞–¥–µ—Ä–∂–∫—É)
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º app –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ª–µ—Ç—è—â–∏–π div
                    
                    await new Promise(r => setTimeout(r, 200)); // –Ω–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É —É–¥–∞—Ä–∞–º–∏
                    
                    blockDiv.classList.add('shaking');
                    setTimeout(() => blockDiv.classList.remove('shaking'), 200);
                    tg.HapticFeedback.impactOccurred('light');

                    // –ù–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω –±–ª–æ–∫—É
                    blockState[col].hp -= dmg;
                    
                    if (blockState[col].hp <= 0) {
                        blockDiv.innerText = "0";
                        // –ë–ª–æ–∫ —Ä–∞–∑–±–∏—Ç! –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—É–Ω–¥—É–∫
                        let win = await openChest(col);
                        totalWin += win;
                        
                        // –†–µ—Å–ø–∞–≤–Ω –±–ª–æ–∫–∞
                        let newBlock = generateRandomBlock();
                        blockState[col] = newBlock;
                        
                        // –ê–Ω–∏–º–∞—Ü–∏—è —Å–º–µ–Ω—ã –±–ª–æ–∫–∞
                        blockDiv.style.opacity = '0';
                        setTimeout(() => {
                            blockDiv.className = `block ${newBlock.type}`;
                            blockDiv.innerText = newBlock.hp;
                            blockDiv.style.opacity = '1';
                        }, 200);
                    } else {
                        // –û–±–Ω–æ–≤–ª—è–µ–º HP –≤–∏–∑—É–∞–ª—å–Ω–æ
                        blockDiv.innerText = blockState[col].hp;
                    }
                }
            }
        }

        async function openChest(colIndex) {
            let chestDiv = document.getElementById(`chest-${colIndex}`);
            chestDiv.innerText = 'üí∞'; // –û—Ç–∫—Ä—ã—Ç—ã–π —Å—É–Ω–¥—É–∫
            
            // –†–∞—Å—á–µ—Ç –≤—ã–∏–≥—Ä—ã—à–∞
            let multiplier = (Math.random() * (CONFIG.multiplierMax - CONFIG.multiplierMin) + CONFIG.multiplierMin).toFixed(1);
            let winAmount = Math.floor(CONFIG.spinCost * multiplier);
            
            showFloatText(colIndex, `x${multiplier}\n+${winAmount}`, '#ffff00');
            
            balance += winAmount;
            updateBalanceUI();
            tg.HapticFeedback.notificationOccurred('success');

            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—É–Ω–¥—É–∫ –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
            setTimeout(() => {
                chestDiv.innerText = 'üì¶';
            }, 1000);

            return winAmount;
        }

        function showFloatText(colIndex, text, color) {
            let miningCol = document.getElementById(`mining-col-${colIndex}`);
            let floatDiv = document.createElement('div');
            floatDiv.className = 'multiplier-popup';
            floatDiv.innerText = text;
            floatDiv.style.color = color;
            miningCol.appendChild(floatDiv);
            
            setTimeout(() => floatDiv.remove(), 1000);
        }

        // –ó–∞–ø—É—Å–∫
        init();

    </script>
</body>
</html>
